<!DOCTYPE html>
<html>
<head>
	<title>BlipKit</title>
	<link rel="stylesheet" href="assets/blipkit.css">
</head>
<body>

<div class="wrapper">
	<div class="controls-wrapper">
		<label class="control">
			<span class="label-text">Waveform</span>
		 	<select name="waveform">
				<option value="1">Square</option>
				<option value="2">Triangle</option>
				<option value="3">Noise</option>
				<option value="4">Sawtooth</option>
				<option value="5">Sine</option>
			</select>
		</label>
		<label class="control">
			<span class="label-text">Attack</span>
			<input name="attack" type="range" min="0" max="120" value="0">
		</label>
		<label class="control">
			<span class="label-text">Decay</span>
			<input name="decay" type="range" min="0" max="120" value="24">
		</label>
		<label class="control">
			<span class="label-text">Sustain</span>
			<input name="sustain" type="range" min="0" max="255" value="192">
		</label>
		<label class="control">
			<span class="label-text">Release</span>
			<input name="release" type="range" min="0" max="240" value="48">
		</label>
		<div class="control">
			<button id="start">Start</button>
		</div>
		<div class="control">
			<button id="stop">Stop</button>
		</div>
	</div>
	<div class="source-wrapper">
		<textarea id="source">st:21

[instr:0
	vnv:5:255:<:12:192:>:10:0:10:64:10:0
	a:-50:<:0:>
]

[instr:1
	vnv:3:255:<:16:64:>:20:0:20:192:20:0
	a:<:0:>:0:1200
	dcnv:0:1:<:20:8:>:20:6
]

[instr:2
	vnv:3:255:<:16:64:>:20:0:20:192:20:0
	a:<:0:>:0:-1200
	dcnv:0:5:<:20:5:>:20:2:20:4
]

[instr:10
	a:-1200:<:0:>
	adsr:3:30:127:10
]

[instr:12
	vnv:10:127:10:255:<:10:178:>:10:255:40:0
	anv:0:0:120:0:<:17:30:17:-30:>
	dc:<:6:>
]

[instr:15
	adsr:3:20:178:20
]

[instr:16
	%adsr:3:20:178:20
	vnv:4:255:<:12:255:>:10:32:10:127:10:0
	anv:0:1200:5:1200:0:0:<:5:0:>
]

[instr:20
	v:255:255:255:255:255:192:164:128:96:78:64:32:15:0
	a:-900:700:250:<:0:>
]

[instr:21
	v:255:255:255:192:128:64:32:16:0
	a:-900:700:250:<:0:>
]

[instr:25
	v:255:255:255:255:255:255:255:255:255:255:192:164:128:96:<:78:>:64:32:15:0
	a:-900:700:250:<:0:>
]

[instr:30
	adsr:0:12:220:20
]

[wave:0
	s:255:-96:-127:0:-127:-64:-32:0
]

[track:square
	[grp:0
		a:e3;s:1;r;s:3
		a:e2;s:1;r;s:3
		a:e3;s:1;r;s:3
		a:e2;s:1;r;s:3

		a:e3;s:1;r;s:3
		a:e4;s:1;r;s:3
		a:e3;s:1;r;s:3
		a:f#4;s:1;r;s:3

		a:e3;s:1;r;s:3
		a:e2;s:1;r;s:3
		a:g3;s:1;r;s:3
		a:g2;s:1;r;s:3

		a:f#3;s:1;r;s:3
		a:f#2;s:1;r;s:3
		a:d3;s:1;r;s:3
		a:e3;s:1;r;s:3
	]

	[grp:1
		a:g3;s:1;r;s:3
		a:g2;s:1;r;s:3
		a:g3;s:1;r;s:3
		a:g2;s:1;r;s:3

		a:f#3;s:1;r;s:3
		a:f#4;s:1;r;s:3
		a:e3;s:1;r;s:3
		a:e4;s:1;r;s:3

		a:e3;s:1;r;s:3
		a:e2;s:1;r;s:3
		a:a3;s:1;r;s:3
		a:a2;s:1;r;s:3

		a:f#3;s:1;r;s:3
		a:f#2;s:1;r;s:3
		a:d3;s:1;r;s:3
		a:e3;s:1;r;s:3
	]

	[grp:10
		a:e3;s:1;r;s:3
		a:e2;s:1;r;s:3
		a:e3;s:1;r;s:3
		a:e2;s:1;r;s:3

		a:e3;s:1;r;s:3
		a:e4;s:1;r;s:3
		a:e3;s:1;r;s:3
		a:f#4;s:1;r;s:3

		a:e3;s:1;r;s:3
		a:e2;s:1;r;s:3
		a:g3;s:1;r;s:3
		a:g2;s:1;r;s:3

		a:f#3;s:1;r;s:3
		a:f#3;s:1;r;s:3
		s:8
	]

	[grp:20
		e:pr:10;e:vs:40

		s:64
	]

	v:178
	p:0
	i:2
	dc:4

	% #0
	pt:-1189
	g:0
	g:10

	xb

	pt:-11
	v:220
	p:0
	i:2

	% #1
	g:0
	g:0
	g:0
	pt:-1200;g:10;pt:0

	% #2
	g:1
	g:1

	% #3
	s:64
	s:64
	s:64
	s:64

	% #4
	g:0
	g:0
	g:0
	g:0

	% #5
	i:12
	g:20
	s:64
	s:64
	s:64
	i:2

	x

]

[track:square
	[grp:0
		a:g3;s:1;r;s:3
		a:g3;s:1;r;s:3
		a:g4;s:1;r;s:3
		a:g3;s:1;r;s:3

		a:g3;s:1;r;s:3
		a:g3;s:1;r;s:3
		a:g4;s:1;r;s:3
		a:a3;s:1;r;s:3

		a:g3;s:1;r;s:3
		a:g3;s:1;r;s:3
		a:b4;s:1;r;s:3
		a:b3;s:1;r;s:3

		a:a3;s:1;r;s:3
		a:a3;s:1;r;s:3
		a:f#4;s:1;r;s:3
		a:g3;s:1;r;s:3
	]

	[grp:1
		a:b3;s:1;r;s:3
		a:b3;s:1;r;s:3
		a:b4;s:1;r;s:3
		a:b3;s:1;r;s:3

		a:a3;s:1;r;s:3
		a:a3;s:1;r;s:3
		a:g4;s:1;r;s:3
		a:g3;s:1;r;s:3

		a:g3;s:1;r;s:3
		a:g3;s:1;r;s:3
		a:c4;s:1;r;s:3
		a:c3;s:1;r;s:3

		a:a3;s:1;r;s:3
		a:a3;s:1;r;s:3
		a:f#4;s:1;r;s:3
		a:g3;s:1;r;s:3
	]

	[grp:10
		a:g3;s:1;r;s:3
		a:g3;s:1;r;s:3
		a:g4;s:1;r;s:3
		a:g3;s:1;r;s:3

		a:g3;s:1;r;s:3
		a:g3;s:1;r;s:3
		a:g4;s:1;r;s:3
		a:a3;s:1;r;s:3

		a:g3;s:1;r;s:3
		a:g3;s:1;r;s:3
		a:b4;s:1;r;s:3
		a:b3;s:1;r;s:3

		a:a3;s:1;r;s:3
		a:a3;s:1;r;s:3
		s:8
	]

	[grp:11
		a:b3;s:1;r;s:3
		a:b3;s:1;r;s:3
		a:b4;s:1;r;s:3
		a:b3;s:1;r;s:3

		a:a3;s:1;r;s:3
		a:a3;s:1;r;s:3
		a:g4;s:1;r;s:3
		a:g3;s:1;r;s:3

		a:g3;s:1;r;s:3
		a:g3;s:1;r;s:3
		a:c4;s:1;r;s:3
		a:c3;s:1;r;s:3

		a:a3;s:1;r;s:3
		a:a3;s:1;r;s:3
		s:8
	]

	v:178
	p:48
	i:2
	dc:4

	% #0
	s:64
	s:64

	xb

	v:220
	p:92
	i:2

	% #1
	g:0
	g:0
	g:0
	pt:-1200;g:10;pt:0

	% #2
	g:1
	g:1

	% #3
	i:1;p:-48;pt:-1200
	g:0
	g:0
	g:0
	pt:-2400;p:48;g:10
	i:2;p:92;pt:0

	% #4
	g:0
	g:0
	g:0
	g:0

	% #5
	i:1;p:-48;pt:-1200
	g:1
	g:1
	g:1
	pt:-1200;p:48;g:11
	i:2;p:92;pt:0

	x

]

[track:square
	[grp:0
		a:b3;s:1;r;s:3
		a:b4;s:1;r;s:3
		a:b3;s:1;r;s:3
		a:b3;s:1;r;s:3

		a:b3;s:1;r;s:3
		a:b4;s:1;r;s:3
		a:b3;s:1;r;s:3
		a:c3;s:1;r;s:3

		a:g3;s:1;r;s:3
		a:g4;s:1;r;s:3
		a:d3;s:1;r;s:3
		a:d3;s:1;r;s:3

		a:c3;s:1;r;s:3
		a:c4;s:1;r;s:3
		a:a3;s:1;r;s:3
		a:b3;s:1;r;s:3
	]

	[grp:1
		a:d3;s:1;r;s:3
		a:d4;s:1;r;s:3
		a:d3;s:1;r;s:3
		a:d3;s:1;r;s:3

		a:c3;s:1;r;s:3
		a:c4;s:1;r;s:3
		a:b3;s:1;r;s:3
		a:b3;s:1;r;s:3

		a:b3;s:1;r;s:3
		a:b4;s:1;r;s:3
		a:e2;s:1;r;s:3
		a:e2;s:1;r;s:3

		a:d3;s:1;r;s:3
		a:d4;s:1;r;s:3
		a:a3;s:1;r;s:3
		a:b3;s:1;r;s:3
	]

	[grp:10
		a:b3;s:1;r;s:3
		a:b4;s:1;r;s:3
		a:b3;s:1;r;s:3
		a:b3;s:1;r;s:3

		a:b3;s:1;r;s:3
		a:b4;s:1;r;s:3
		a:b3;s:1;r;s:3
		a:c3;s:1;r;s:3

		a:g3;s:1;r;s:3
		a:g4;s:1;r;s:3
		a:d3;s:1;r;s:3
		a:d3;s:1;r;s:3

		a:c3;s:1;r;s:3
		a:c4;s:1;r;s:3
		s:8
	]

	[grp:11
		a:d3;s:1;r;s:3
		a:d4;s:1;r;s:3
		a:d3;s:1;r;s:3
		a:d3;s:1;r;s:3

		a:c3;s:1;r;s:3
		a:c4;s:1;r;s:3
		a:b3;s:1;r;s:3
		a:b3;s:1;r;s:3

		a:b3;s:1;r;s:3
		a:b4;s:1;r;s:3
		a:e2;s:1;r;s:3
		a:e2;s:1;r;s:3

		a:d3;s:1;r;s:3
		a:d4;s:1;r;s:3
		s:8
	]

	v:178
	p:0
	i:2
	p:-48
	dc:4

	% #0
	s:64
	s:64

	xb

	v:220
	p:-92
	i:2

	% #1
	g:0
	g:0
	g:0
	pt:-1200;g:10;pt:0

	% #2
	g:1
	g:1

	% #3
	i:1;p:48;pt:-1200
	g:0
	g:0
	g:0
	pt:-2400;p:-48;g:10
	i:2;p:-92;pt:0

	% #4
	g:0
	g:0
	g:0
	g:0

	% #5
	i:1;p:48;pt:-1200
	g:1
	g:1
	g:1
	pt:-1200;p:-48;g:11
	i:2;p:-92;pt:0

	x

]

[track:square
	[grp:0
		e:pr:24

		a:e3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:g3;s:1;r;s:1
		at:6;a:e3;s:1;r;s:1
		a:b2;a:e3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:b2;s:3;r;s:1

		a:e3;s:1;r;s:1
		at:6;a:g3;s:1;r;s:1
		a:f#3;s:1;r;s:1
		at:6;a:c3;s:1;r;s:1
		a:b2;s:2;r;s:2
		a:a3;s:2;a:b3;s:1;r;s:1

		a:e3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:g3;s:1;e:vb:12:20;s:2;r;s:1;e:vb;
		a:c3;a:d3;s:2;r;s:2;
		a:a3;a:b3;s:2;r;
		rt:15;a:g3;s:1;r;
		at:6;rt:21;a:f#3;s:1;r;

		a:a3;s:1;r;s:1
		at:6;a:g3;s:1;r;s:1
		a:e3;s:1;r;s:1;
		at:6;a:g3;s:2
		a:e3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:b2;s:3;r;s:1
	]

	[grp:10
		e:pr:24

		a:e3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:g3;s:1;r;s:1
		at:6;a:e3;s:1;r;s:1
		a:b2;a:e3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:e3;s:3;r;s:1

		a:e3;s:1;r;s:1
		at:6;a:g3;s:1;r;s:1
		a:f#3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:e3;s:2;r;s:2
		e:vb:9:30;a:b2;s:3;r;s:1;e:vb

		a:g3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:g3;s:1;e:vb:12:20;s:2;r;s:1;e:vb
		a:c3;a:d3;s:2;r;s:2;
		a:a3;a:b3;s:2;r;
		rt:15;a:g3;s:1;r;
		at:6;rt:21;a:f#3;s:1;r

		a:a3;s:1;r;s:1
		at:6;a:g3;s:1;r;s:1
		a:e3;s:1;r;s:1;
		at:6;a:g3;s:2
		a:e3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:b2;s:3;r;s:1
	]

	[grp:11
		e:pr:24

		a:e3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:g3;s:1;r;s:1
		at:6;a:e3;s:1;r;s:1
		a:b2;a:e3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:e3;s:3;r;s:1

		a:e3;s:1;r;s:1
		at:6;a:g3;s:1;r;s:1
		a:f#3;s:1;r;s:1
		at:6;a:c3;s:1;r;s:1
		a:d3;s:2;r;s:2
		e:vb:9:30;a:f#2;s:3;r;s:1;e:vb

		a:g3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:c3;s:2;s:1;a:d3;s:1
		a:f#3;s:1;r;s:1
		at:6;a:b3;s:1;r;s:1
		e:vb:12:20;a:e3;s:3;r;s:1;e:vb

		a:g3;s:1;r;s:1
		at:6;a:f#3;s:1;r;s:1
		a:e3;s:1;r;s:1;
		at:6;a:a2;s:1;r;s:1
		a:b2;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:e3;s:3;r;s:1
	]

	[grp:1
		e:pr:24

		a:e3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:g3;s:1;r;s:1
		at:6;a:e3;s:1;r;s:1
		a:b2;a:e3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:b2;s:3;r;s:1

		a:d3;s:1;r;s:1
		at:6;a:g3;s:1;r;s:1
		a:e3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:g3;s:2;r;s:2
		a:a3;s:2;a:b3;s:1;r;s:1

		a:f#3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:g3;s:3;r;s:1
		a:a3;s:1;r;s:1
		at:6;a:a3;s:1;r;s:1
		e:vb:12:20;a:d3;s:3;r;s:1;e:vb

		a:g3;s:1;r;s:1
		at:6;a:f#3;s:1;r;s:1
		a:e3;s:1;r;s:1;
		at:6;a:a2;s:1;r;s:1
		a:b2;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:e3;s:3;r;s:1
	]

	[grp:2
		e:pr:20

		a:g3;s:1;r;s:1
		at:6;a:f#3;s:1;r;s:1
		a:g3;s:1;r;s:1
		at:6;a:f#3;s:1;r;s:1

		a:g3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		e:vb:10:30;a:b3;s:3;r;s:1;e:vb

		a:a3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:f#3;a:g3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1

		a:a3;s:2;r;s:2;
		a:b3;s:2;r;s:2;

		a:e3;s:3;r;s:1;
		a:g3;a:b3;s:2;r;
		rt:15;a:g3;s:1;r;
		at:6;rt:21;a:d3;s:1;r;

		a:e3;s:1;r;s:1;
		at:6;a:d3;s:1;r;s:1
		a:a2;s:2;r;s:2;

		a:f#2;s:2;r;s:2;
		a:g2;s:2;r;s:2;

		e:vb:10:30;a:c3;a:d3;s:4;a:e3;s:1;r;s:3;e:vb
	]

	[grp:3
		e:pr:20

		a:g3;s:1;r;s:1
		at:6;a:f#3;s:1;r;s:1
		a:g3;s:1;r;s:1
		at:6;a:f#3;s:1;r;s:1

		a:g3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		e:vb:10:30;a:b3;s:3;r;s:1;e:vb

		a:a3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:f#3;a:g3;s:1;r;s:1
		at:6;a:c3;s:1;r;s:1

		a:f#3;s:2;r;s:2;
		a:g3;s:2;r;s:2;

		a:d3;s:3;r;s:1;
		a:a3;a:b3;s:2;r;
		rt:15;a:g3;s:1;r;
		at:6;rt:21;a:a3;s:1;r;

		a:f#3;s:1;r;s:1;
		at:6;a:d3;s:1;r;s:1;
		a:b2;s:1;s:1;r;s:2;

		a:f#2;s:2;r;s:2;
		a:g2;s:2;r;s:2;

		e:vb:10:30;a:g3;a:f#3;s:4;a:e3;s:1;r;s:3;e:vb
	]

	[grp:30
		e:pr:20

		a:g3;s:1;r;s:1
		at:6;a:f#3;s:1;r;s:1
		a:g3;s:1;r;s:1
		at:6;a:f#3;s:1;r;s:1

		a:g3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		e:vb:10:30;a:b3;s:3;r;s:1;e:vb

		a:a3;s:1;r;s:1
		at:6;a:d3;s:1;r;s:1
		a:f#3;a:g3;s:1;r;s:1
		at:6;a:c3;s:1;r;s:1

		a:f#3;s:2;r;s:2;
		a:g3;s:2;r;s:2;

		a:d3;s:3;r;s:1;
		a:a3;a:b3;s:2;r;
		rt:15;a:g3;s:1;r;
		at:6;rt:21;a:a3;s:1;r;

		a:f#3;s:1;r;s:1;
		at:6;a:d3;s:1;r;s:1;
		a:b2;s:1;s:1;r;s:2;

		a:f#2;s:2;r;s:2;
		a:g2;s:2;r;s:2;

		s:8
	]

	dc:4
	i:0
	p:9

	w:0

	% #0
	v:186
	g:10
	g:11

	xb

	% #1
	v:230
	g:0
	g:1
	g:0
	g:1

	% #2
	g:2
	g:3

	% #3
	s:64
	s:64
	s:64
	v:255;g:30;w:0;v:230

	% #4
	v:230
	g:0
	g:1
	g:0
	g:1

	% #5
	s:64
	s:64
	s:64
	s:64

	x

]

[track:sawtooth
	[grp:0
		e:pr:20

		a:e0;s:3;r;s:1
		a:e0;s:3;r;s:1
		a:e0;s:3;r;s:1
		a:e1;s:1;r;s:1
		at:6;a:e0;s:1;r;s:1

		a:e0;s:3;r;s:1
		a:e0;s:1;r;s:1
		at:6;a:e0;s:1;r;s:1
		a:e0;s:3;r;s:1
		a:f#1;s:1;r;s:1
		at:6;a:f#0;s:1;r;s:1

		a:e0;s:3;r;s:1
		a:e0;s:1;r;s:1
		at:6;a:e0;s:1;r;s:1

		a:g0;s:3;r;s:1
		a:g0;s:1;r;s:1
		at:6;a:g1;s:1;r;s:1

		a:f#0;s:3;r;s:1
		a:f#0;s:1;r;s:1
		at:6;a:f#0;s:1;r;s:1

		a:d0;s:3;r;s:1
		a:e0;s:1;r;s:1
		at:6;a:e0;s:1;r;s:1
	]

	[grp:1
		e:pr:20

		a:g0;s:3;r;s:1
		a:g0;s:3;r;s:1
		a:g0;s:3;r;s:1
		a:g1;s:1;r;s:1
		at:6;a:g0;s:1;r;s:1

		a:f#0;s:3;r;s:1
		a:f#0;s:1;r;s:1
		at:6;a:f#0;s:1;r;s:1
		a:e0;s:3;r;s:1
		a:e1;s:1;r;s:1
		at:6;a:e0;s:1;r;s:1

		a:e0;s:3;r;s:1
		a:e0;s:1;r;s:1
		at:6;a:e0;s:1;r;s:1

		a:a0;s:3;r;s:1
		a:a0;s:1;r;s:1
		at:6;a:a1;s:1;r;s:1

		a:f#0;s:3;r;s:1
		a:f#0;s:1;r;s:1
		at:6;a:f#0;s:1;r;s:1

		a:d0;s:3;r;s:1
		a:d0;s:1;r;s:1
		at:6;a:d0;s:1;r;s:1
	]

	v:224
	i:16
	pt:1211
	dc:8

	% #0
	s:64
	s:64

	xb

	% #1
	g:0
	g:0
	g:0
	s:64

	% #2
	g:1
	g:1

	% #3
	g:0
	g:0
	g:0
	s:64

	% #4
	g:0
	g:0
	g:0
	g:0

	% #5
	s:64
	s:64
	s:64
	s:64

	x

]

[track:square
	[grp:0
		e:pr:20

		a:e0;s:3;r;s:1
		a:e0;s:3;r;s:1
		a:e0;s:3;r;s:1
		a:e1;s:1;r;s:1
		at:6;a:e0;s:1;r;s:1

		a:e0;s:3;r;s:1
		a:e0;s:1;r;s:1
		at:6;a:e0;s:1;r;s:1
		a:e0;s:3;r;s:1
		a:f#1;s:1;r;s:1
		at:6;a:f#0;s:1;r;s:1

		a:e0;s:3;r;s:1
		a:e0;s:1;r;s:1
		at:6;a:e0;s:1;r;s:1

		a:g0;s:3;r;s:1
		a:g0;s:1;r;s:1
		at:6;a:g1;s:1;r;s:1

		a:f#0;s:3;r;s:1
		a:f#0;s:1;r;s:1
		at:6;a:f#0;s:1;r;s:1

		a:d0;s:3;r;s:1
		a:e0;s:1;r;s:1
		at:6;a:e0;s:1;r;s:1
	]

	[grp:1
		e:pr:20

		a:g0;s:3;r;s:1
		a:g0;s:3;r;s:1
		a:g0;s:3;r;s:1
		a:g1;s:1;r;s:1
		at:6;a:g0;s:1;r;s:1

		a:f#0;s:3;r;s:1
		a:f#0;s:1;r;s:1
		at:6;a:f#0;s:1;r;s:1
		a:e0;s:3;r;s:1
		a:e1;s:1;r;s:1
		at:6;a:e0;s:1;r;s:1

		a:e0;s:3;r;s:1
		a:e0;s:1;r;s:1
		at:6;a:e0;s:1;r;s:1

		a:a0;s:3;r;s:1
		a:a0;s:1;r;s:1
		at:6;a:a1;s:1;r;s:1

		a:f#0;s:3;r;s:1
		a:f#0;s:1;r;s:1
		at:6;a:f#0;s:1;r;s:1

		a:d0;s:3;r;s:1
		a:d0;s:1;r;s:1
		at:6;a:d0;s:1;r;s:1
	]

	v:192
	dc:8
	i:10
	pt:1193 % +1 octave -7 cents

	% #0
	s:64
	s:64

	xb

	% #1
	g:0
	g:0
	g:0
	s:64

	% #2
	g:1
	g:1

	% #3
	s:64
	pt:2385;dc:2
	g:0
	g:0
	s:64
	dc:8;pt:1193 % +1 octave -7 cents

	% #4
	g:0
	g:0
	g:0
	g:0

	% #5
	s:64
	s:64
	s:64
	s:64

	x

]

[track:sine
	[grp:0
		e:pr:24
		s:48

		s:12
		s:4
	]

	[grp:1
		e:pr:24
		a:e3;a:e0;s:2;r;s:1
		s:5
		a:e3;a:e0;s:2;r;
		s:6

		a:e3;a:e0;s:2;r;s:1
		s:5
		a:e3;a:e0;s:2;r;
		s:2
		a:e3;a:e0;s:2;r;
		s:2

		a:e3;a:e0;s:2;r;s:1
		s:5
		a:e3;a:e0;s:2;r;
		s:6

		a:e3;a:e0;s:2;r;s:1
		s:5
		a:e3;a:e0;s:2;r;
		s:2
		a:e3;a:e0;s:2;r;
		s:2
	]

	[grp:2
		e:pr:24
		a:e3;a:e0;s:2;r;s:2
		s:4
		s:8

		a:e3;a:e0;s:2;r;s:2
		s:4
		s:8

		a:e3;a:e0;s:2;r;s:2
		s:4
		a:e3;a:e0;s:2;r;
		s:6

		a:e3;a:e0;s:2;r;s:2
		s:4
		a:e3;a:e0;s:1;r;s:1
		s:2;
		a:e3;a:e0;s:1;r;s:1
		s:2
	]

	[grp:3
		e:pr:24
		a:e3;a:e0;s:2;r;s:2
		s:4
		s:8

		a:e3;a:e0;s:2;r;s:2
		s:4
		s:8

		a:e3;a:e0;s:2;r;s:2
		s:4
		a:e3;a:e0;s:2;r;
		s:6

		a:e3;a:e0;s:2;r;s:2
		s:4
		a:e3;a:e0;s:1;r;s:3
		s:4
	]

	[grp:4
		e:pr:24
		a:e3;a:e0;s:2;r;s:2
		s:4
		s:8

		a:e3;a:e0;s:2;r;s:2
		s:4
		s:8

		a:e3;a:e0;s:2;r;s:2
		s:4
		a:e3;a:e0;s:2;r;
		s:6

		a:e3;a:e0;s:2;r;s:2
		s:4
		a:e3;a:e0;s:1;r;s:1
		at:6;a:e3;a:e0;s:1;r;s:1
		a:e3;a:e0;s:1;r;s:1
		s:2
	]

	% #0
	s:64
	g:0

	xb

	% #1
	g:1
	g:1
	g:1
	g:4

	% #2
	g:1
	g:1

	% #3
	g:2
	g:2
	g:2
	g:3

	% #4
	g:1
	g:1
	g:1
	g:1

	% #5
	g:2
	g:2
	g:2
	g:3

	x

]

[track:noise

	[grp:0
		e:pr:20
		i:20;a:g4;a:g1;s:2;r
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		i:21;a:g4;s:2;r
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		i:20;a:g5;s:1;s:3;r

		i:20;a:g4;a:g1;s:2;r
		at:6;v:92;i:21;a:g5;s:2;r;v:255
		i:21;a:g4;s:2;r
		at:6;v:92;i:21;a:g5;s:2;r;v:255
		s:2
		i:21;a:g4;s:2;r

		i:20;a:g5;s:1;s:7;r

		i:20;a:g4;a:g1;s:2;r
		v:92;i:21;a:g5;s:2;r;v:255

		i:21;a:g4;s:2;r
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		i:20;a:g5;s:1;s:3;r

		i:20;a:g4;a:g1;s:2;r
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		i:20;a:g3;a:g4;s:2;r

		v:92;i:21;a:g5;s:2;r;v:255
		at:6;i:20;a:g4;a:g1;s:2;r
		v:192;i:21;a:g4;s:2;r;v:255
		i:20;a:g5;s:1;s:3;r
		i:21;a:g4;s:1;s:3;r
	]

	[grp:2
		e:pr:20
		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		i:20;a:g5;s:1;s:3;r

		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255
		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255
		s:2
		s:2

		i:20;a:g5;s:1;s:7;r

		s:2
		v:92;i:21;a:g5;s:2;r;v:255

		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		i:20;a:g5;s:1;s:3;r

		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		s:2

		v:92;i:21;a:g5;s:2;r;v:255
		s:2
		s:2
		i:20;a:g5;s:1;s:3;r
		s:4
	]


	[grp:3
		e:pr:20
		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		i:20;a:g5;s:1;s:3;r

		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255
		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255
		s:2
		s:2

		i:20;a:g5;s:1;s:7;r

		s:2
		v:92;i:21;a:g5;s:2;r;v:255

		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		i:20;a:g5;s:1;s:3;r

		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		s:2

		v:92;i:21;a:g5;s:2;r;v:255
		s:2
		s:2
		i:20;a:g5;s:1;s:3;r
		s:4
	]

	[grp:4
		e:pr:20
		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		i:20;a:g5;s:1;s:3;r

		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255
		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255
		s:2
		s:2

		i:20;a:g5;s:1;s:7;r

		s:2
		v:92;i:21;a:g5;s:2;r;v:255

		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		i:20;a:g5;s:1;s:3;r

		s:2
		at:6;v:92;i:21;a:g5;s:2;r;v:255

		s:2

		v:92;i:21;a:g5;s:2;r;v:255
		s:4
		i:20;a:g5;s:1;s:1;r
		at:6;i:21;a:g4;s:1;s:1;r
		i:21;a:g5;s:1;s:1;r
		at:6;i:21;a:g4;s:1;s:1;r
	]

	% #0
	s:64
	s:64

	xb

	% #1
	g:0
	g:0
	g:0
	g:4

	% #2
	g:0
	g:0

	% #3
	s:64
	g:2
	g:3
	s:64

	% #4
	g:0
	g:0
	g:0
	g:0

	% #5
	s:64
	s:64
	s:64
	s:64

	x

]
</textarea>
	</div>
	<div class="screen-wrapper">
		<svg viewBox="0 0 12 8" preserveAspectRatio="none" id="screen"></svg>
	</div>
</div>

<script>

class BlipKitController {
	constructor(module) {
		const numFrames = 1024;
		const numChannels = 2;

		this.module = module;
		this.context = new (window.AudioContext || window.webkitAudioContext)();
		this.source = this.context.createBufferSource();
		this.generatorNode = this.context.createScriptProcessor(numFrames, numChannels, numChannels);

		this.generatorNode.onaudioprocess = (audioProcessingEvent) => {
			const audioBuffer = this.module._getBuffer();
			const inputBuffer = audioProcessingEvent.inputBuffer;
			const outputBuffer = audioProcessingEvent.outputBuffer;

			this.generate(inputBuffer.length);

			for (let channel = 0; channel < outputBuffer.numberOfChannels; channel++) {
				const outputData = outputBuffer.getChannelData(channel);
				const channelData = this.heapFloat32Array(audioBuffer, inputBuffer.length * channel, inputBuffer.length);

				outputData.set(channelData);
			}
		}
	}

	connectNode() {
		this.source.connect(this.generatorNode);
		this.generatorNode.connect(this.context.destination);
	}

	disconnectNode() {
		this.source.connect(this.generatorNode);
		this.generatorNode.connect(this.context.destination);
	}

	generate(length) {
		return this.module._generate(length);
	}

	heapFloat32Array(array, offset, length) {
		const memory = this.module.HEAPF32;
		const offsetStart = array / memory.BYTES_PER_ELEMENT + offset;
		const offsetEnd = offsetStart + length;

		return memory.subarray(offsetStart, offsetEnd);
	}

	updateEnvelope(attack, decay, sustain, release) {
		controller.module._setEnvelope(attack, decay, sustain, release);
	}

	init() {
		const module = this.module;
		let down = false;
		let arpType = 0;

		setTimeout(() => {
			this.connectNode();
		}, 10);

		function setNoteFromEvent(e, target) {
			const rect = target.getBoundingClientRect();
			const width = rect.width;
			const height = rect.height;
			let x = e.clientX - rect.left;
			let y = e.clientY - rect.top;
			x = Math.floor(x / width * 12);
			y = 7 - Math.floor(y / height * 8);
			const tone = y * 12 + x;
			const toneIdx = tone % 12;
			let newArpType = 0;

			if ([0, 3, 4, 5, 7].indexOf(toneIdx) !== -1) {
				newArpType = 1;
			}
			else {
				newArpType = 2;
			}

			/*if (newArpType !== arpType) {
				arpType = newArpType;

				switch (arpType) {
					case 1: {
						module._setMajorArpeggio();
						break;
					}
					case 2: {
						module._setMinorArpeggio();
						break;
					}
				}
			}*/

			module._setNote(tone);
		}

		let svg = document.querySelector('#screen');

		svg.addEventListener('mousedown', function (e) {
			down = true;
			setNoteFromEvent(e, svg);
			e.preventDefault();
		});

		svg.addEventListener('mousemove', function (e) {
			if (down) {
				setNoteFromEvent(e, svg);
			}
		});

		document.addEventListener('mouseup', function () {
			down = false;
			module._setNote(-1);
		});

		document.querySelector('#start').addEventListener('click', function () {
			const source = document.querySelector('#source').value;

			let result = Module.ccall('compileSource', null, ['string'], [source]);

			console.log(result);

			Module._startContext();
		});

		document.querySelector('#stop').addEventListener('click', function () {
			Module._stopContext();
		});

		const attackField = document.querySelector('input[name=attack]');
		const decayField = document.querySelector('input[name=decay]');
		const sustainField = document.querySelector('input[name=sustain]');
		const releaseField = document.querySelector('input[name=release]');

		function updateEnvelope() {
			const attack = attackField.value;
			const decay = decayField.value;
			const sustain = sustainField.value;
			const release = releaseField.value;

			controller.updateEnvelope(attack, decay, sustain, release);
		}

		[attackField, decayField, sustainField, releaseField].forEach((element) => {
			element.addEventListener('change', updateEnvelope);
		});

		updateEnvelope();
	}
}

const waveformShift = 4 << 12;
const BK_SQUARE     = waveformShift + 1;
const BK_TRIANGLE   = waveformShift + 2;
const BK_NOISE      = waveformShift + 3;
const BK_SAWTOOTH   = waveformShift + 4;
const BK_SINE       = waveformShift + 5;
const BK_CUSTOM     = waveformShift + 6;
const BK_SAMPLE     = waveformShift + 7;

let BlipKit = {
	ready: () => {
		controller.init();
	},
};

let controller = new BlipKitController(BlipKit);

let screen = document.querySelector('#screen');

for (let x = 0; x < 12; x++) {
	for (let y = 0; y < 8; y++) {
		let i = y * 12 + x;
		let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
		rect.setAttribute('width', '0.95px');
		rect.setAttribute('height', '0.95px');
		rect.setAttribute('x', (x + 0.025) + 'px');
		rect.setAttribute('y', (y + 0.025) + 'px');
		rect.setAttribute('fill', '#fff');
		rect.setAttribute('opacity', (1 - (y + 1) / 8) * 0.25);
		screen.appendChild(rect);
	}
}

document.querySelector('select[name=waveform]').addEventListener('change', function (e) {
	const value = waveformShift + parseInt(this.selectedOptions[0].value);
	controller.module._setWaveform(value);
});

</script>
<script src="assets/blipkit.js"></script>

</body>
</html>
